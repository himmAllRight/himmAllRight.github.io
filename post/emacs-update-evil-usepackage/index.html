<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Emacs Config Redo - Evil &amp; Use-Package -- λ ryan. himmelwright. net</title>

    

    
    <link href="http://ryan.himmelwright.net/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="http://ryan.himmelwright.net/css/clean-blog.min.css" rel="stylesheet">

    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    
    
    



    
    <script type="text/javascript">
        var _paq = _paq || [];
         
        _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
        _paq.push(["setCookieDomain", "*.ryan.himmelwright.net"]);
        _paq.push(["setDomains", ["*.ryan.himmelwright.net"]]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="//cloud.himmelwright.net/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <noscript><p><img src="//cloud.himmelwright.net/piwik/piwik.php?idsite=1&rec=1" style="border:0;" alt="" /></p></noscript>
        



</head>

<body>

    
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://ryan.himmelwright.net">λ ryan. himmelwright. net</a>
            </div>

                       
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li>
                        <a href="http://ryan.himmelwright.net/">home</a>
                    </li>
                    
                    <li>
                        <a href="http://ryan.himmelwright.net/pages/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="http://ryan.himmelwright.net/pages/homelab/">Homelab</a>
                    </li>
                    
                    <li>
                        <a href="http://ryan.himmelwright.net/post/">Archives</a>
                    </li>
                    
                    <li>
                        <a href="http://ryan.himmelwright.net/post/index.xml">RSS</a>
                    </li>
                    
                  </ul>
            </div>
           

        </div>
        
    </nav>




<header class="intro-header" style="background-image: url('http://ryan.himmelwright.net/img/header-images/roger-williams-park-leaves1.jpg')">
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Emacs Config Redo - Evil &amp; Use-Package</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
Posted by <a href="#">Ryan Himmelwright</a> on Fri, May 18, 2018







<br />
Tags <a href="http://ryan.himmelwright.net/tags/linux">linux</a>, <a href="http://ryan.himmelwright.net/tags/programming">programming</a>, <a href="http://ryan.himmelwright.net/tags/dev">dev</a>, <a href="http://ryan.himmelwright.net/tags/emacs">emacs</a>, <a href="http://ryan.himmelwright.net/tags/dotfiles">dotfiles</a>

                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <span class="header-caption">Roger Williams Park, Providence RI</span>
    
    </header>

    
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <p>After switching to <a href="http://spacemacs.org">Spacemacs</a> for the last year
or two, it&rsquo;s about time to back and pull togeather <em>my own</em> emacs
configuration again. However, spacemacs has shown me several packages
that I want to incorporate into my new emacs setup. Rather than
resurrect and Frankenstein the changes into my old <code>.emacs</code>
file&hellip; I&rsquo;m starting from scratch.</p>

<p></p>

<p><a href="../../img/posts/emacs-config-evil-usepackage/newemacs1.png"><img src="../../img/posts/emacs-config-evil-usepackage/newemacs1.png" style="max-width: 100%; float: left; margin: 0px 15px 0px 0px;" alt="New Emacs Window" /></a></p>

<div class="caption">A window of my New Emacs configuration</div>

<h2 id="evil-mode">Evil Mode</h2>

<h4 id="history">History</h4>

<p>The one emacs package that spacemacs <em>really</em> got me addicted to was
<a href="https://github.com/emacs-evil/evil">Evil</a>, which emulates the main
features of the <a href="https://www.vim.org">vim</a> text editor. I <em>started</em>
with emacs in college, but eventually switched to Vim which, became
the first power editor that I <em>really</em> got into (I even bought a
<a href="https://www.amazon.com/dp/059652983X/?tag=mh0b-20&amp;hvadid=78271540595342&amp;hvqmt=b&amp;hvbmt=bb&amp;hvdev=c&amp;ref=pd_sl_y7m3vu93e_b">book</a>
to learn it better). I stuck with Vim until I became a professonial
LISP developer, and the switch back to Emacs was impossible to ignore,
and obvious.</p>

<p><a href="../../img/posts/emacs-config-evil-usepackage/vim.png"><img src="../../img/posts/emacs-config-evil-usepackage/vim.png" style="max-width: 100%; float: left; margin: 0px 15px 0px 0px;" alt="A Vim Window" /></a></p>

<div class="caption">The Vim editor</div>

<p>Even after switching to back Emacs, I have still enjoyed using command
line applications like <a href="https://cmus.github.io">cmus</a>,
<a href="https://github.com/ranger/ranger">ranger</a>, and
<a href="http://w3m.sourceforge.net">w3m</a>, many of which are influenced by Vim
and often incorporate similar keyboard commands (at least the <code>j</code>,
<code>k</code>, <code>l</code>, <code>;</code> navigation). While it isn&rsquo;t ideal for everything (I
prefer to <em>write</em>, but not nessicarially <em>edit</em> code with emacs-syle
navigation), I never lost my love for the homerow-centric, and
efficient vim-style movement commands.</p>

<h4 id="best-of-both-worlds">Best of Both Worlds</h4>

<p>For the last two years, <a href="http://spacemacs.org/">Spacemacs</a>&rsquo;s default
Vim configuration has provided the best of both worlds. It had all of
the Evil packages pre-configured and optimized, but I could simply hit
<code>Ctrl-z</code>, and jump back to Emacs-mode.</p>

<p>Spacemacs was easy to use and I enjoyed it, but it really started to
have stability issues on my Windows 10 work computer. I thought that
going back to a stock emacs configuration may tone down the
complexity, and increase stability. I started to build a <em>new</em>
configuration based around <code>Evil</code>. During setup, I was happily
surpised to learn that the <code>Ctrl-z</code> option to switch back to
Emacs-mode was a default <code>Evil</code> behavior&hellip; so I still have the best of
both worlds!</p>

<h4 id="starting-config">Starting Config</h4>

<p>Here is my starting <code>Evil</code> setup. I&rsquo;ve nested other <code>use-pacages</code>
inside of it, so that if <code>evil</code> is configured, the packages that
depend on it go ahead and configure themselves too. I&rsquo;m sure this will
grow over time as I add missing packages, but so far, it seems to
provde all the core functionality I need.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lisp" data-lang="lisp"><span style="color:#75715e">;; Evil Mode</span>
(use-package evil
  <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>
  <span style="color:#e6db74">:config</span>

  (evil-mode <span style="color:#ae81ff">1</span>)
  (use-package evil-leader
    <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>
    <span style="color:#e6db74">:config</span>
    (global-evil-leader-mode <span style="color:#66d9ef">t</span>)
    (evil-leader/set-leader <span style="color:#e6db74">&#34;&lt;SPC&gt;&#34;</span>)
    (evil-leader/set-key
      <span style="color:#e6db74">&#34;s s&#34;</span> <span style="color:#e6db74">&#39;swiper</span>
      <span style="color:#e6db74">&#34;d x w&#34;</span> <span style="color:#e6db74">&#39;delete-trailing-whitespace</span>)) 

  (use-package evil-surround
    <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>
    <span style="color:#e6db74">:config</span> (global-evil-surround-mode))

  (use-package evil-indent-textobject
    <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>)

  (use-package evil-org
    <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>
    <span style="color:#e6db74">:config</span>
    (evil-org-set-key-theme 
	  <span style="color:#f92672">&#39;</span>(textobjects insert navigation additional shift todo heading))
    (add-hook <span style="color:#e6db74">&#39;org-mode-hook</span> (lambda () (evil-org-mode))))

  (use-package powerline-evil
    <span style="color:#e6db74">:ensure</span> <span style="color:#66d9ef">t</span>
    <span style="color:#e6db74">:config</span>
    (powerline-evil-vim-color-theme)))</code></pre></div>
<p>I think it needs more key bindings over time&hellip;</p>

<h2 id="use-package">Use Package</h2>

<p>After my setting up an initial install of the Evil mode parts, I
discovered the amazing
<a href="https://github.com/jwiegley/use-package">use-package</a>. I have come
across it before reading blog posts, but never actually tried
it. After realizing how well it worked, I immediately combed through
my <code>.emacs</code> file, converting all of my <code>(require 'package-name)</code> calls
to <code>use-package</code> forms instead.</p>

<h4 id="setup">Setup</h4>

<p>After ensuring the <a href="http://melpa.org">MELPA</a> repos are added and
initialized:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lisp" data-lang="lisp"><span style="color:#75715e">;; Add Melpa packages to Repos</span>
(require <span style="color:#e6db74">&#39;package</span>)
(add-to-list <span style="color:#e6db74">&#39;package-archives</span> <span style="color:#f92672">&#39;</span>(<span style="color:#e6db74">&#34;melpa&#34;</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#34;http://melpa.org/packages/&#34;</span>))
(package-initialize)</code></pre></div>
<p>The <code>use-package</code> package can be installed next. I wrapped the
install commands in an <code>unless</code>, so that when my emacs loads, it
only installs <code>use-package</code> if it is not already installed.</p>

<p>Afterwards, make sure to <code>(require 'use-package)</code>. It only needs to
happen during compile, so I have mine in an <code>(evail-when compile ...)</code>.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-lisp" data-lang="lisp">(unless (package-installed-p <span style="color:#e6db74">&#39;use-package</span>)
  (package-refresh-contents)
  (package-install <span style="color:#e6db74">&#39;use-package</span>))

(eval-when-compile
  (require <span style="color:#e6db74">&#39;use-package</span>))</code></pre></div>
<p>I keep all of this at the top of my configuration, which works well
even when initializing a new computer.</p>

<h4 id="bye-bye-emacs-init-el">Bye Bye emacs_init.el</h4>

<p>When I last had my own custom emacs config, I had to also maintain an
<code>emacs_init.el</code> file. This was an emacs-lisp script that used a
<code>mapcar</code> to apply <code>#'package-install</code> across an ever-growing list of
emacs packages my configuration required. My goal was to have a
script, so that when configuring Emacs on a new system, I could just load
and evaluate the contents of <code>emacs_init.el</code>, and everything required
for <code>.emacs</code> would automatically install.</p>

<p>The reality was that it never fully worked. There were always a few
packages that would error, or that I had forgoten to add the last time
I updated my <code>.emacs</code> file. With <code>use-package</code>, this might be an issue
of the pastm, as it allows me to combine my emacs init script <em>with</em>
my configuration files.</p>

<h4 id="key-bindings">Key Bindings</h4>

<p>After convirting all of my <code>(require 'PACKAGE-NAME)</code> calls and related
expressions to filled <code>use-package</code> wrappers, I learned about the <code>:bind</code>
parameter. Instead of manually setting key binds with a <code>setq</code>,
<code>:bind</code> takes a list of dotted pairs and binds the function (defined
in the second spot of the pair), to the key sequence stated in the
first spot of the pair.</p>

<p>For example, to setup my preferred <code>ispell</code> key-bindings, I used the
following <code>:bind</code> parameter in my <code>ispell</code> <code>use-package</code> call:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(use-package ispell
  :ensure <span style="color:#66d9ef">t</span>
  :bind
  ((<span style="color:#e6db74">&#34;C-c w&#34;</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;ispell-word</span>)
   (<span style="color:#e6db74">&#34;C-c r&#34;</span> <span style="color:#f92672">.</span> <span style="color:#e6db74">&#39;ispell-region</span>)))</code></pre></div>
<p>This helps to keep the configuration a bit cleaner and organized. The
syntax is also straight-forward and easy to remember.</p>

<h2 id="system-specific-load-files">System Specific Load Files</h2>

<p>Finally, I moved all my work-specific emacs configuration (setting up
Allego Common Lisp, defining some helper functions&hellip; and anything
Windows specific) into it&rsquo;s own <code>emacs-work.el</code> file. With that in it&rsquo;s
own seperate file, I just needed to <code>load</code> it from my main <code>.emacs</code>
configuration. The only issue with that, is I only want it to load on
my <em>work computer</em>. So, I wrapped it with a nice little handler:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(when (<span style="color:#a6e22e">string-equal</span> <span style="color:#a6e22e">system-name</span> <span style="color:#e6db74">&#34;LAFAYETTE&#34;</span>)
  (<span style="color:#a6e22e">load</span> <span style="color:#e6db74">&#34;~/.emacs-work.el&#34;</span>))</code></pre></div>
<p>This works because I don&rsquo;t name my home computers with the same name
as my work machine. This little tweak worked so well, that I decided
to make another file, <code>emacs-linux.el</code>, that I could dump my linux
and/or home specific configuration into. I only load it when on a
GNU/Linux machine:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-emacs-lisp" data-lang="emacs-lisp">(when (<span style="color:#a6e22e">string-equal</span> system-type <span style="color:#e6db74">&#34;gnu/linux&#34;</span>)
  (<span style="color:#a6e22e">load</span> <span style="color:#e6db74">&#34;~/.emacs-linux.el&#34;</span>))</code></pre></div>
<p>I&rsquo;ve really enjoyed the ability to only load parts of my configuration
when a certain condition is met. Breaking down my configuration into
use-specific components seems like a good idea (like abstracting messy
code to smaller functions). Right now, I try to keep my configuration
file partitioned into sections, based on use-case (Writting,
Development, Appearance, etc). However, as I continue to fine-tune my
emacs setup, I think I might break those sections into actual <em>files</em>,
and then <code>load</code> them from the main config.</p>

<p>The only issue I can see with that is that it can be confusing with
 overlaping use-cases. However, I already have to deal with that in a
 single configuration (which <em>section</em> to put it in), and my process
 of converting everyting to <code>use-package</code> has actually started to
 minimize that issue. So it might work&hellip;</p>

<h2 id="next-steps">Next Steps</h2>

<p>Now that I have an &ldquo;<code>Evil</code>&rdquo; Emacs setup configured, things should be
returning to business as usuall. As I work, I sure there&rsquo;ll be a
forgotten package here or there that needs to added. However, with
<code>use-package</code>, that should be a piece of cake, and easy to maintain
from here on out.</p>

                    
                    
                        <div style="float: left; text-decoration: underline; text-align: right;">Next Post:</div>
                    
                    
                         <div style="float: right; text-decoration: underline; text-align: right;">Prev Post:</div>
                    
                    <br>
                    
                        <a href="http://ryan.himmelwright.net/post/org-babel-setup/" style="text-align: left; float: left; max-width: 40%;">Organizing my Emacs config with Org-Babel</a>
                    
                    
                        <a href="http://ryan.himmelwright.net/post/sql-intro/" style="text-align: right; float: right; max-width: 40%">SQL Intro</a>
                    

			
			<div class="comment-section">
			  
   <div id="disqus_thread"></div>
<script>
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ryan-himmelwright" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


			</div>
                </div>
            </div>
        </div>
    </article>

        <hr>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                    
                      <li>
                        <a href="mailto:ryan@himmelwright.net">
                          <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                          </span>
                        </a>
                      </li>
                    
                    
                    <li>
                      <a href="https://github.com/himmAllRight">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://www.linkedin.com/in/ryan-himmelwright-b3891774/">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://www.instagram.com/himmelwr/">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-instagram fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://twitter.com/himmAllRight17">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                  </ul>
                  <p class="copyright text-muted">Copyright © Ryan Himmelwright. Site created with Hugo</p>
                </div>
            </div>
        </div>
    </footer>

    
    <script src="http://ryan.himmelwright.net/js/jquery.min.js"></script>

    
    <script src="http://ryan.himmelwright.net/js/bootstrap.min.js"></script>

    
    <script src="http://ryan.himmelwright.net/js/clean-blog.js"></script>

    
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-123-45', 'auto');
ga('send', 'pageview');
</script>


</body>

</html>

