<!DOCTYPE html>
<html lang="en-us">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Automated Nativefier App builds -- λ ryan. himmelwright. net</title>

    

    
    <link href="http://ryan.himmelwright.net/css/bootstrap.min.css" rel="stylesheet">

    
    <link href="http://ryan.himmelwright.net/css/clean-blog.min.css" rel="stylesheet">

    
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800' rel='stylesheet' type='text/css'>

    
    
    



    
    <script type="text/javascript">
        var _paq = _paq || [];
         
        _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
        _paq.push(["setCookieDomain", "*.ryan.himmelwright.net"]);
        _paq.push(["setDomains", ["*.ryan.himmelwright.net"]]);
        _paq.push(['trackPageView']);
        _paq.push(['enableLinkTracking']);
        (function() {
        var u="//cloud.himmelwright.net/piwik/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '1']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
        })();
        </script>
        <noscript><p><img src="//cloud.himmelwright.net/piwik/piwik.php?idsite=1&rec=1" style="border:0;" alt="" /></p></noscript>
        



</head>

<body>

    
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="http://ryan.himmelwright.net">λ ryan. himmelwright. net</a>
            </div>

                       
            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    
                    <li>
                        <a href="../../">home</a>
                    </li>
                    
                    <li>
                        <a href="../../pages/about/">About</a>
                    </li>
                    
                    <li>
                        <a href="../../pages/homelab/">Homelab</a>
                    </li>
                    
                    <li>
                        <a href="../../tags">tags</a>
                    </li>
                    
                    <li>
                        <a href="../../post/">Archives</a>
                    </li>
                    
                    <li>
                        <a href="../../post/index.xml">RSS</a>
                    </li>
                    
                  </ul>
            </div>
           

        </div>
        
    </nav>




<header class="intro-header" style="background-image: url('http://ryan.himmelwright.net/img/posts/automated-nativefier-app-builds/troll_closeup.jpeg')">
    
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                <div class="post-heading">
                    <h1>Automated Nativefier App builds</h1>
                    <h2 class="subheading"></h2>
                    <span class="meta">
                        
Posted by <a href="#">Ryan Himmelwright</a> on Sat, Oct 31, 2020







<br />
Tags <a href="../../tags/linux">linux</a>, <a href="../../tags/containers">containers</a>, <a href="../../tags/fedora">fedora</a>, <a href="../../tags/ansible">ansible</a>

                    </span>
                </div>
            </div>
        </div>
    </div>
    
    <span class="header-caption">Kill Devil Hills, NC</span>
    
    </header>

    
    <article>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                    
                    <p>Most applications we use today are fancy web pages, wrapped up in a desktop
shell. Many people even forgo desktop builds, instead opting to run webapps
simply as another tab in their web browser (Ex: Slack,
Discord, Notion). Personally, I prefer to have dedicated windows opened for my
essential tools. As a result, I love using
<a href="https://github.com/jiahaog/nativefier">nativefier</a> to create desktop versions
of my favorite web-based applicatons. The only problem is&hellip; it can be a pain to
setup. Lets fix that.</p>

<h2 id="how-i-use-nativefier">How I use nativefier</h2>

<h3 id="what-apps-i-use-it-for">What Apps I use it for</h3>

<p><a href="../../img/posts/automated-nativefier-app-builds/pocketcasts.png"><img alt="Using Pocketcasts as a nativefier build" src="../../img/posts/automated-nativefier-app-builds/pocketcasts.png" style="max-width:
100%;"/></a>
<div class="caption">Using the Pocketcasts web app in a desktop window via
nativefier</div></p>

<p>I use nativefier for all of the web services that are missing a Linux client,
or web tools that I use often and want a dedicated desktop client for. On most days,
I use the following tools via a nativefier desktop build:</p>

<ul>
<li><strong>Pocket</strong> - to read articles</li>
<li><strong>Pocketcasts</strong> - to listend to synced podcasts between my phone and computer</li>
<li><strong>Fastmail</strong> - For my personal email and calendar</li>
<li><strong>homeassistant</strong> - To control parts of my house (mostly lights and temp)</li>
<li><strong>Notion</strong> - My <a href="../../post/trying-notion/">notes and planning tool</a></li>
<li><strong>Soundcloud</strong> - For music while working</li>
</ul>

<p>Also, while not used every day, I have made nativefier builds for <strong>twitch</strong> and
<strong>icloud</strong>.  These are both apps that exist on other desktops but don&rsquo;t have an
official Linux build.</p>

<h3 id="how-i-make-them-feel-like-normal-apps">How I make them <em>feel</em> like normal apps</h3>

<p>There are a few steps I take to help make these builds <em>feel</em> more like native
ones.</p>

<h4 id="desktop-files">Desktop Files</h4>

<p><center>
<a href="../../img/posts/automated-nativefier-app-builds/nativefier_krunner.png"><img alt="The builds show up as normal applications" src="../../img/posts/automated-nativefier-app-builds/nativefier_krunner.png" style="max-width:
100%;"/></a>
<div class="caption">The Pocket and Pocketcasts builds showing as normal
applications in search</div>
</center></p>

<p>The first, and argualy most important step I take, is creating a <a href="https://specifications.freedesktop.org/desktop-entry-spec/desktop-entry-spec-latest.html">desktop
entity</a>
for each nativefier build. A desktop entity defines an application
in Gnome and KDE Plasma desktop environments, allowing it to show up in menus and
launchers. Defining an entity for the nativefier builds tells the system to to
treat the build as a normal application, which is what we want.</p>

<h4 id="icons">Icons</h4>

<p>The second action I&rsquo;ve started doing is making sure that I use proper icons
when I <em>run</em> nativefier. I already needed the icon for creating the desktop
entity, but I noticed the icon displayed in the running app often didn&rsquo;t match
the one defined in the desktop file. This extra step resolves this issue and
helps make everything look more cohesive.</p>

<h3 id="how-i-usually-create-nativefier-builds">How I <em>usually</em> create nativefier builds</h3>

<p><center>
<a href="../../img/posts/automated-nativefier-app-builds/desktop-app-edit.png"><img alt="Coping to a new computer often requires editing all the application files" src="../../img/posts/automated-nativefier-app-builds/desktop-app-edit.png" style="max-width:
100%;"/></a>
<div class="caption">Coping to a new computer often requires editing all the application files</div>
</center></p>

<p>While these additional steps help nativefier builds behave like real desktop applications,
it adds a bunch extra work to the creation process. When I want to make a new
nativefier app, I usually have to:</p>

<ul>
<li>Install nativefier and it&rsquo;s dependencies (usually in a podman container)</li>
<li>Build the application to a build directory</li>
<li>Find an icon for the application and add it to my <code>~/.local/share/icons/</code>
folder</li>
<li>Create a new <code>.desktop</code> file for the application, which involves:

<ul>
<li>Filling out the description</li>
<li>Changing the exec paths.</li>
<li>Adding the icon path</li>
</ul></li>
<li>Verify it works (something is usually missing)</li>
</ul>

<p>To save some time when setting up a new system, I often copy the build
directories along with the desktop and icon files. However, even that can be
quite tedious. For example, if the new system uses a different username (<code>ryan</code> vs.
<code>rhimmew</code>), I have to update all of the desktop files to reflect the change.</p>

<p>We can do better. Lets automate it.</p>

<h2 id="using-a-podman-container-instead">Using a podman container instead</h2>

<p>Before diving into the automating the steps, there is one improvement
to my normal process I want to make. Instead of installing nativefier from a
<code>npm</code> install, I want to switch to using an ephemeral nativefier
container for the builds. This has several benefits, including not having to install
dependencies, and always using the latest version for the automation. Plus&hellip;
containers are fun.</p>

<p>After tweaking the suggested <a href="https://github.com/jiahaog/nativefier#usage-with-docker">docker
instructions</a>, I was
able to get a nativefier container building apps on my desktop using podman:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash"><span style="color:#75715e"># Pull the Image</span>
podman pull jiahaog/nativefier

<span style="color:#75715e"># Run a build for a container</span>
podman run --rm  -v ICONS_DIR src -v NATIVEFIER_BUILD_DIR target jiahaog/nativefier --icon /src/ICON --name NAME -p linux -a x64 URL /target</code></pre></div>
<p>This command had a few parameters to swap:</p>

<ul>
<li><code>ICONS_DIR</code>: the directory that contains the application icons to build
with.</li>
<li><code>NATIVEFIER_BUILD_DIR</code>: the directory to save the application builds to</li>
<li><code>ICON</code>: The filename of the image to use for the icon</li>
<li><code>NAME</code>: The name of the application (ex: <code>pocket</code> or <code>homeassistant</code>)</li>
<li><code>URL</code>: The <em>url</em> of the webapp to build</li>
</ul>

<p>This command spins up a podman container, passes our variables through, and builds a
nativefier app. After finishing, the container automatically deletes itself.</p>

<h2 id="automating-the-process">Automating the process</h2>

<p>Now that we&rsquo;ve figured out how to run nativefier with podman, we can focus on
writing the automation. Like I have <a href="../../post/foundryvtt-service-ansible-role/">done
previously</a>, I will be implementing the
automation by creating a new role to use in my ansible playbooks. If you are
unfamilar with roles, checkout the <a href="../../post/ansible-quickstart/">ansible quickstart
post</a> I wrote earlier this year.</p>

<p>To start, I&rsquo;ll create a folder for the new role, with <code>tasks</code>, <code>defaults</code>, <code>files</code>, and
<code>templates</code> sub directories.</p>

<h3 id="vars">Vars</h3>

<p>First, lets define default values for the variables we will use in tasks and template files:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">user</span>: <span style="color:#e6db74">&#34;{{ ansible_user_id }}&#34;</span>  <span style="color:#75715e"># User to run as</span>
<span style="color:#f92672">nativefier_build_dir</span>: <span style="color:#e6db74">&#34;/tmp/&#34;</span>  <span style="color:#75715e"># Location to build apps at</span>
<span style="color:#f92672">nativefier_dir</span>: <span style="color:#e6db74">&#34;/home/{{ user }}/Builds/&#34;</span> <span style="color:#75715e"># Location to move completed builds</span>
<span style="color:#f92672">icons_dir</span>: <span style="color:#e6db74">&#34;/home/{{ user }}/.local/share/icons/&#34;</span> <span style="color:#75715e"># App Icon location</span>
<span style="color:#f92672">applications_dir</span>: <span style="color:#e6db74">&#34;/home/{{ user }}/.local/share/applications/&#34;</span> <span style="color:#75715e"># desktop entry location</span></code></pre></div>
<p>We will define one more variable which won&rsquo;t have a default, <code>nativefier_apps</code>. However, I&rsquo;ll
talk about that later when we use the role in a playbook.</p>

<h3 id="templates">Templates</h3>

<p>Next, lets create the one template file we need for this role: an
<code>application.desktop</code> file. Create a new file in the <code>templates</code> directory
named <code>nativefier.desktop.j2</code> and paste in the following contents:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-ini" data-lang="ini"><span style="color:#66d9ef">[Desktop Entry]</span>
<span style="color:#a6e22e">Name</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{ item.name }}</span>
<span style="color:#a6e22e">Comment</span><span style="color:#f92672">=</span><span style="color:#e6db74">Nativefier app for {{ item.name }}</span>
<span style="color:#a6e22e">Exec</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{ nativefier_dir }}/{{ item.name }}-linux-x64/{{ item.name }}</span>
<span style="color:#a6e22e">Terminal</span><span style="color:#f92672">=</span><span style="color:#e6db74">false</span>
<span style="color:#a6e22e">Type</span><span style="color:#f92672">=</span><span style="color:#e6db74">Application</span>
<span style="color:#a6e22e">Icon</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{ item.icon }}</span>
<span style="color:#a6e22e">Categories</span><span style="color:#f92672">=</span><span style="color:#e6db74">Multimedia;</span>
<span style="color:#a6e22e">TryExec</span><span style="color:#f92672">=</span><span style="color:#e6db74">{{ nativefier_dir }}/{{ item.name }}-linux-x64/{{ item.name }}</span></code></pre></div>
<p>This template will take the variables for each nativefier app we define in the
playbook, and use them to fill out a desktop file for each app.</p>

<h3 id="files">Files</h3>

<p><center>
<a href="../../img/posts/automated-nativefier-app-builds/icons.png"><img alt="The icons folder" src="../../img/posts/automated-nativefier-app-builds/icons.png" style="max-width:
100%;"/></a>
<div class="caption">The role&rsquo;s files folder, containing the app icons</div>
</center></p>

<p>Before writing tasks, there is one more role directory to fill: <code>files</code>.  We
want to include the icon files for each application in this role. So,  fill the
<code>files</code> sub-directory with the icon files to use.</p>

<h3 id="tasks">Tasks</h3>

<p>Time to write the tasks. Create and open up a <code>main.yml</code> file in the
tasks sub-directory.</p>

<p>The first few tasks will check and ensure that the directories we intend to use
exist. This is generally a good practice to prevent playbooks from breaking due
to missing folders:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Ensure Icon dir exists&#34;</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ icons_dir }}&#34;</span>
    <span style="color:#f92672">state</span>: <span style="color:#ae81ff">directory</span>

- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Ensure applications dir exists&#34;</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ applications_dir }}&#34;</span>
    <span style="color:#f92672">state</span>: <span style="color:#ae81ff">directory</span>

- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Ensure {{ nativefier_build_dir }} exists&#34;</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ nativefier_build_dir }}&#34;</span>
    <span style="color:#f92672">state</span>: <span style="color:#ae81ff">directory</span>

- <span style="color:#f92672">name</span>: <span style="color:#e6db74">&#34;Ensure {{ nativefier_dir }} exists&#34;</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ nativefier_dir }}&#34;</span>
    <span style="color:#f92672">state</span>: <span style="color:#ae81ff">directory</span></code></pre></div>
<h4 id="managing-icon-files">Managing Icon Files</h4>

<p>Next, add a small task that will copy the icons we included with the role,
to the user&rsquo;s local icon folder:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Move icons to local folder</span>
  <span style="color:#f92672">copy</span>: <span style="color:#ae81ff">src=&#34;{{ item.icon }}&#34; dest=&#34;{{ icons_dir }}/{{ item.icon }}&#34;</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span></code></pre></div>
<p>This will ensure that all the icons are already in place when we build both the
nativefier app and the <code>.deskop</code> files.</p>

<h4 id="automating-the-podman-builds">Automating the podman builds</h4>

<p>We can now define a few tasks that will pull and run the nativefier container
using podman. <em>(Note: This could be done with docker&hellip; but I prefer podman XD)</em>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Pull down nativefier container image</span>
  <span style="color:#f92672">shell</span>: <span style="color:#e6db74">&#34;podman pull jiahaog/nativefier&#34;</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Build Nativefier app via podman</span>
  <span style="color:#f92672">shell</span>: <span style="color:#e6db74">&#34;podman run --rm --security-opt label=disable -v {{ icons_dir }}:/src -v {{ nativefier_build_dir }}:/target jiahaog/nativefier --icon /src/{{ item.icon }} --name {{ item.name}} -p linux -a x64 {{ item.url }} /target&#34;</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span>

- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Clean out nativefier dir</span>
  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">true</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ nativefier_dir }}/{{ item.name }}-linux-x64&#34;</span>
    <span style="color:#f92672">state</span>: <span style="color:#ae81ff">absent</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span>

  <span style="color:#75715e"># I don&#39;t love this, but copy was too slow</span>
- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Move Builds to Nativefier Location</span>
  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">True</span>
  <span style="color:#f92672">shell</span>: <span style="color:#e6db74">&#34;mv {{ nativefier_build_dir }}/{{ item.name }}-linux-x64 {{ nativefier_dir }}/{{ item.name }}-linux-x64&#34;</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span></code></pre></div>
<p>These tasks also move the built app to the final location.</p>

<h4 id="manaing-application-files">Manaing Application Files</h4>

<p>Lastly, with icons in place and the application builds complete, we can create the application
entry files by adding this final task:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Generate Application Desktop Files</span>
  <span style="color:#f92672">template</span>:
    <span style="color:#f92672">src</span>: <span style="color:#ae81ff">templates/nativefier.desktop.j2</span>
    <span style="color:#f92672">dest</span>: <span style="color:#e6db74">&#34;{{ applications_dir }}/{{ item.name }}.desktop&#34;</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span></code></pre></div>
<p>And there we go, that&rsquo;s it! Well&hellip; sort of.</p>

<h2 id="selinux-woes">Selinux woes</h2>

<p>While this &lsquo;<em>worked on my computer</em>&rsquo;, when I tested it on my laptop and
in some VMs&hellip; it failed.</p>

<h3 id="issues">Issues</h3>

<p>Every time I ran the playbook, I hit this error:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">Error during build. Run with --verbose <span style="color:#66d9ef">for</span> details. <span style="color:#f92672">[</span>Error: EACCES: permission denied, mkdir <span style="color:#e6db74">&#39;/target/linux-x64-template&#39;</span><span style="color:#f92672">]</span> <span style="color:#f92672">{</span>
  errno: -13,
  code: <span style="color:#e6db74">&#39;EACCES&#39;</span>,
  syscall: <span style="color:#e6db74">&#39;mkdir&#39;</span>,
  path: <span style="color:#e6db74">&#39;/target/linux-x64-template&#39;</span>
<span style="color:#f92672">}</span></code></pre></div>
<p>I was able to tell the error occurred while running the podman container. I
assumed it might be <code>selinux</code> related, but was unable to sort out a solution
right away.</p>

<h3 id="the-fix">The Fix</h3>

<p>Eventually after browsing the internet, I learned that my easiest solution was
to add the option <code>--security-opt label=disable</code> to my <code>podman run</code> command, to
turn off label separation for the container. I&rsquo;m sure there is a better, more
secure soltion I could do. However, I figured this was at least a good compromise of
being easy to implement, but more secure than the common (and wrong) suggestion
of &ldquo;<em>just disable selinux</em>&rdquo;.</p>

<h3 id="one-last-fix">One last fix&hellip;</h3>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">drwxr-xr-x. <span style="color:#ae81ff">1</span> <span style="color:#ae81ff">100999</span> <span style="color:#ae81ff">100999</span>  <span style="color:#ae81ff">560</span> Oct <span style="color:#ae81ff">25</span> 20:40 jellyfin-linux-x64</code></pre></div>
<p>Lastly, I wanted to add one more cleanup task. My builds had the ugly uid/gid
pair of <code>100999 100999</code>, so I a task to change ownership to the <code>user</code>:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml">- <span style="color:#f92672">name</span>: <span style="color:#ae81ff">Change Permissons of Nativefier Dirs</span>
  <span style="color:#f92672">become</span>: <span style="color:#66d9ef">True</span>
  <span style="color:#f92672">file</span>:
    <span style="color:#f92672">path</span>: <span style="color:#e6db74">&#34;{{ nativefier_dir }}/{{ item.name }}-linux-x64&#34;</span>
    <span style="color:#f92672">owner</span>: <span style="color:#e6db74">&#34;{{ user }}&#34;</span>
    <span style="color:#f92672">group</span>: <span style="color:#e6db74">&#34;{{ user }}&#34;</span>
  <span style="color:#f92672">loop</span>: <span style="color:#e6db74">&#34;{{ nativefier_apps }}&#34;</span></code></pre></div>
<p>After that change:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">drwxr-xr-x. <span style="color:#ae81ff">1</span> ryan ryan  <span style="color:#ae81ff">560</span> Oct <span style="color:#ae81ff">25</span> 20:40 jellyfin-linux-x64</code></pre></div>
<p>Much better!</p>

<h2 id="example-adding-it-to-my-playbooks">Example adding it to my playbooks</h2>

<p>With the role complete, it is <em>finally</em> time to add it to a playbook. I define
playbooks to provision all of my machines, so I will just add it to them. First
make sure the role is added to the list of roles used by the playbook.  For
example:</p>
<pre><code>  roles:
    - apps/nativefier</code></pre>
<p>Next, define a new var named <code>nativefier_apps</code>. This variable is a list of
dictionaries, with each dictionary providing the values for a different
nativefier application. Each nativefier build requires three variables to be
defined:</p>

<ul>
<li><code>name</code>: The name of the application</li>
<li><code>icon</code>: The filename (including ext) of the icon file to for the application</li>
<li><code>url</code>: The address for the webpage to build as a nativefier app</li>
</ul>

<p>So, to build my <code>pocket</code>, <code>fastmail</code>, and <code>homeassistant</code> apps, I added the
following to my playbook:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">nativefier_apps</span>:
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">pocket</span>
    <span style="color:#f92672">icon</span>: <span style="color:#ae81ff">pocket.png</span>
    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;https://app.getpocket.com&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">fastmail</span>
    <span style="color:#f92672">icon</span>: <span style="color:#ae81ff">fastmail.png</span>
    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;https://www.fastmail.com&#34;</span>
  - <span style="color:#f92672">name</span>: <span style="color:#ae81ff">homeassistant</span>
    <span style="color:#f92672">icon</span>: <span style="color:#ae81ff">homeassistant.png</span>
    <span style="color:#f92672">url</span>: <span style="color:#e6db74">&#34;http://homeassistant.local:8123&#34;</span></code></pre></div>
<p>That should be it! Afterwards, my playbooks could build and configure all
my nativefier applications automatically!</p>

<h2 id="conclusion">Conclusion</h2>

<p><center>
<a href="../../img/posts/automated-nativefier-app-builds/nativefier-windows.png"><img alt="My desktop covered in nativefier apps" src="../../img/posts/automated-nativefier-app-builds/nativefier-windows.png" style="max-width:
100%;"/></a>
<div class="caption">My desktop covered in some of my nativefier apps.</div>
</center></p>

<p>I have wanted to create this role for a very long time and am glad I finally
did. Nativefier is such an amazing tool, and paring it with podman and ansible
has somehow managed to make it shine even more. Enjoy!</p>

                    
                    
                        <div style="float: right; text-decoration: underline; text-align: right;">Next Post:</div>
                    
                    
                         <div style="float: left; text-decoration: underline; text-align: right;">Prev Post:</div>
                    
                    <br>
                    
                        <a href="http://ryan.himmelwright.net/post/ergodox-ez-initial-review/" style="text-align: right; float: right; max-width: 40%;">My new Ergox-EZ Keyboard -- Initial Thoughts</a>
                    
                    
                        <a href="http://ryan.himmelwright.net/post/decided-to-get-an-ergodox/" style="text-align: left; float: left; max-width: 40%">Decided to get an Ergodox</a>
                    

			
			<div class="comment-section">
			  
   <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "himmallright" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>


			</div>
                </div>
            </div>
        </div>
    </article>

        <hr>
    
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
                  <ul class="list-inline text-center">
                    
                      <li>
                        <a href="mailto:ryan@himmelwright.net">
                          <span class="fa-stack fa-lg">
                            <i class="fa fa-circle fa-stack-2x"></i>
                            <i class="fa fa-envelope-o fa-stack-1x fa-inverse"></i>
                          </span>
                        </a>
                      </li>
                    
                    
                    <li>
                      <a href="https://github.com/himmAllRight">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                    <li>
                      <a href="https://www.linkedin.com/in/ryan-himmelwright-b3891774/">
                        <span class="fa-stack fa-lg">
                          <i class="fa fa-circle fa-stack-2x"></i>
                          <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                        </span>
                      </a>
                    </li>
                    
                  </ul>
<p class="copyright text-muted">

<a rel="license" href="http://creativecommons.org/licenses/by/4.0/"><img
  alt="Creative Commons License" style="border-width:0"
  src="https://i.creativecommons.org/l/by/4.0/88x31.png" /></a><br />This work
by <a xmlns:cc="http://creativecommons.org/ns#" href="http://ryan.himmelwright.net" property="cc:attributionName" rel="cc:attributionURL">Ryan Himmelwright</a> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/">Creative Commons Attribution 4.0 International License</a>.
</p>
                </div>
            </div>
        </div>
    </footer>

    
    <script src="http://ryan.himmelwright.net/js/jquery.min.js"></script>

    
    <script src="http://ryan.himmelwright.net/js/bootstrap.min.js"></script>

    
    <script src="http://ryan.himmelwright.net/js/clean-blog.js"></script>

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-123-45', 'auto');
	
	ga('send', 'pageview');
}
</script>


</body>

</html>

